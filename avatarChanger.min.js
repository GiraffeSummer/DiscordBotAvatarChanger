const request=require("request"),fs=require("fs"),vars={token:"",path:"",setData:function(t,e){this.path=t,this.token=e,checkDirectory(this.path),tryDirectory(this.path+"avatars.json")||SaveJson({main:{image:""},sample:{image:"pic.png",time:"1-1",duration:30},current:""},this.path+"avatars.json")}};function changeAvatar(t){return new Promise(function(e){let a=t.includes(vars.path)?t.replace(vars.path,""):t;imageData.current!=a?(img=FiletoBase64(t),ChangeAvatarApi(img).then(a=>{1==a.avatar.length?e({success:!1,reason:a.avatar[0]}):(imageData&&(imageData.title&&delete imageData.title,imageData.current=t.includes(vars.path)?t.replace(vars.path,""):t,SaveJson(imageData,vars.path+"avatars.json")),e({success:!0,data:a}))})):e({success:!1,reason:"Already uploaded this image."})})}function GetDay(){imageData=LoadJson(vars.path+"avatars.json"),imageData.current||(imageData.current="");let t=new Date,e={month:t.getMonth()+1,day:t.getDate()},a=!1;for(let t=0;t<Object.keys(imageData).length&&!a;t++){let n=Object.keys(imageData)[t],r=imageData[Object.keys(imageData)[t]];if("main"==n||"current"==n)continue;if(null==r.time||""==r.time)continue;let i={month:r.time.split("-")[1],day:r.time.split("-")[0]};if(e.month==i.month&&e.day.between(i.day,parseInt(i.day)+r.duration))return r.title=n,a=!0,r}if(!a){let t=imageData.main;return t.title="main",t}}module.exports=function(t,e){vars.setData(t,e)},module.exports.changeAvatar=changeAvatar,module.exports.GetDay=GetDay;const timer={loop:void 0,interval:144e5,Start:function(t=timerTrigger,e=!0){e&&t(),this.loop=setInterval(t,this.interval)},Stop:function(){clearInterval(this.loop)},setTimeout:function(t){this.interval=1e3*t}};function timerTrigger(){obj=GetDay(),console.log("changing to:"+obj.title),changeAvatar(vars.path+obj.image).then(t=>{t.success?console.log(obj.title+" - Image was updated"):console.log(t.reason)})}function ChangeAvatarApi(t){return new Promise(function(e){let a={method:"PATCH",url:"https://discordapp.com/api/users/@me",headers:{Authorization:`Bot ${vars.token}`,"Content-Type":"application/json"},body:{avatar:t},json:!0};request(a,function(t,a,n){t&&console.log(t),delete n.token,e(n)})})}function FiletoBase64(t){let e=t.split("/")[t.split("/").length-1],a=fs.readFileSync(t),n=e.split(".").pop();return string=Buffer.from(a).toString("base64"),"data:image/"+n+";base64,"+string}function LoadJson(t){let e;return e=fs.readFileSync(t),JSON.parse(e)}function SaveJson(t,e){let a=JSON.stringify(t,null,4);fs.writeFileSync(e,a)}function checkDirectory(t){try{fs.statSync(t)}catch(e){fs.mkdirSync(t)}}function tryDirectory(t){try{return fs.statSync(t),!0}catch(t){return!1}}module.exports.timer=timer,module.exports.timerTrigger=timerTrigger,Number.prototype.between=function(t,e){return this>t-1&&this<e};